

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  <meta content="noindex, nofollow" name="robots" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Readme &mdash; FV3GFS 0.5.0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Installation" href="installation.html" />
    <link rel="prev" title="Welcome to FV3GFS’s documentation!" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> FV3GFS
          

          
          </a>

          
            
            
              <div class="version">
                0.5.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Readme</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#fv3gfs">FV3GFS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#checking-out">Checking out</a></li>
<li class="toctree-l3"><a class="reference internal" href="#local-machine-installation">Local Machine Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installation-for-clusters">Installation for Clusters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#building-docs">Building Docs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#iterative-development">Iterative development</a></li>
<li class="toctree-l3"><a class="reference internal" href="#usage">Usage</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="state.html">State</a></li>
<li class="toctree-l1"><a class="reference internal" href="developers.html">Developers Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="history.html">History</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">FV3GFS</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Readme</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/readme.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="readme">
<h1>Readme<a class="headerlink" href="#readme" title="Permalink to this headline">¶</a></h1>
<div class="section" id="fv3gfs">
<h2>FV3GFS<a class="headerlink" href="#fv3gfs" title="Permalink to this headline">¶</a></h2>
<p>fv3gfs-wrapper (<cite>import fv3gfs.wrapper</cite>), is a Python wrapper for the FV3GFS
global climate model.</p>
<p>See the [documentation](<a class="reference external" href="https://vulcanclimatemodeling.github.io/fv3gfs-wrapper/f12n7eq5xkoibbqp/index.html">https://vulcanclimatemodeling.github.io/fv3gfs-wrapper/f12n7eq5xkoibbqp/index.html</a>)
for more detailed instructions.</p>
<div class="section" id="checking-out">
<h3>Checking out<a class="headerlink" href="#checking-out" title="Permalink to this headline">¶</a></h3>
<p>This package uses submodules. After you check out the repository, you must run
<cite>git submodule update –init –recursive</cite> in the root directory of this package.</p>
<ul class="simple">
<li><p>Free software: BSD license</p></li>
</ul>
</div>
<div class="section" id="local-machine-installation">
<h3>Local Machine Installation<a class="headerlink" href="#local-machine-installation" title="Permalink to this headline">¶</a></h3>
<p>The Docker image can be built using <cite>make build-docker</cite>, or built and then
tested using <cite>make test-docker</cite> (which will use the existing build if present).
The first time you build, both ESMF and FMS will be
built, taking up quite a lot of time. On subsequent builds, these may be retrieved
from cached images, if you allow caching on your system.</p>
<p>On a host, the package can be built using <cite>make build</cite>, and then installed
in development mode with <cite>pip install -e .</cite>.</p>
<p>This package only supports linux and Python 3.5 or greater.</p>
</div>
<div class="section" id="installation-for-clusters">
<h3>Installation for Clusters<a class="headerlink" href="#installation-for-clusters" title="Permalink to this headline">¶</a></h3>
<p>The default installation method outlined above is suitable for running on a local
computer or on a single cloud VM instance.  If you wish to run FV3 on multiple
compute nodes (eg. on a cluster of multiple computers), the appropriate Docker
image can be built using <cite>build_hpc_docker.sh</cite>.  An user will need to select the
specific configuration (compiler, MPI implementation, GPU support) by setting
the HPC_CONFIG variable in the script.  The user will also need to set the
OUTPUT_IMAGE variable to specify where the final Docker image is to be written
(a DockerHub image address can be used).</p>
<p>Currently, there is support for the GNU 8 and 9 suite of compilers, the MPICH
3.1.4 implementation of MPI and CUDA 10.1 for Nvidia GPU support.</p>
<p>Note that <cite>build_hpc_docker.sh</cite> will build a new Docker image from scratch.  This
build process takes approximately 20 minutes on a single cloud VM with 8 CPUs.</p>
</div>
<div class="section" id="building-docs">
<h3>Building Docs<a class="headerlink" href="#building-docs" title="Permalink to this headline">¶</a></h3>
<p>Once the docker image is built, the documentation can be built and shown using:</p>
<blockquote>
<div><p>make docs-docker</p>
</div></blockquote>
<p>This will produce html documentation in <cite>docs/html</cite>.</p>
</div>
<div class="section" id="iterative-development">
<h3>Iterative development<a class="headerlink" href="#iterative-development" title="Permalink to this headline">¶</a></h3>
<p>When making changes to the Fortran source code, you may want to rebuild just part of
the model, keeping build artifacts between rebuilds. You can do this by running the
docker image with bind-mounts into your local filesystem. Just be sure to <cite>make clean</cite>
when you’re done to remove the build artifacts, or it may cause problems when you
build the docker image.</p>
<p>With the image already built by <cite>make build-docker</cite> or pulled using
<cite>docker pull us.gcr.io/vcm-ml/fv3gfs-wrapper</cite>, run <cite>dev_docker.sh</cite>. This will
bind-mount the <cite>fv3gfs</cite>, <cite>lib</cite>, <cite>tests</cite>, <cite>external</cite>, and <cite>templates</cite> directories into the
docker image. Inside the docker image, you can build or re-build the model with
<cite>make build</cite> inside the <cite>/fv3gfs-wrapper</cite> directory, and run the test suite with
<cite>make test</cite>.</p>
<p>Re-building the model inside the image is necessary since your local
filesystem won’t already have the build artifacts necessary to build
the compiled wrapper.</p>
</div>
<div class="section" id="usage">
<h3>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h3>
<p>Example run scripts are included in [<cite>examples/runfiles</cite>](<a class="reference external" href="https://github.com/VulcanClimateModeling/fv3gfs/tree/master/sorc/fv3gfs.fd/cython_wrapper/examples/runfiles">https://github.com/VulcanClimateModeling/fv3gfs/tree/master/sorc/fv3gfs.fd/cython_wrapper/examples/runfiles</a>).
These run scripts act as a drop-in replacement for <cite>fv3.exe</cite>, and get executed
in the same way, using <cite>mpirun</cite>:</p>
<blockquote>
<div><p>mpirun -np 6 –oversubscribe –allow-run-as-root –mca btl_vader_single_copy_mechanism none python online_code.py</p>
</div></blockquote>
<p>Running these files requires them to be placed inside a valid run directory. This is
done automatically if you run them using <cite>fv3run</cite>, as is done in
the Makefile in that directory.</p>
<p>Please note that the ‘–oversubscribe –allow-run-as-root –mca btl_vader_single_copy_mechanism none’ flags to mpirun
are not needed if you are using the mpich-based Docker images built using the <cite>build_hpc_docker.sh</cite> script.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="installation.html" class="btn btn-neutral float-right" title="Installation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="Welcome to FV3GFS’s documentation!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2019, Vulcan Technologies, LLC

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>